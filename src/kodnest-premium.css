/* KodNest Premium Build System
   Calm, intentional, coherent, confident.
   No gradients. No glass. No neon. No noisy animation.
*/

:root{
  /* --- Color system (max 4 base colors) --- */
  --color-bg: #F7F6F3;        /* off-white */
  --color-text: #111111;      /* primary text */
  --color-accent: #8B0000;    /* deep red */
  --color-success: #5E6F5B;   /* muted green */

  /* Derived colors (do not introduce new base colors) */
  --color-warning: color-mix(in oklab, var(--color-accent) 52%, var(--color-success) 48%);
  --color-surface: color-mix(in oklab, var(--color-bg) 92%, var(--color-text) 8%);
  --color-border: color-mix(in oklab, var(--color-text) 16%, var(--color-bg) 84%);
  --color-border-strong: color-mix(in oklab, var(--color-text) 24%, var(--color-bg) 76%);
  --color-muted-text: color-mix(in oklab, var(--color-text) 72%, var(--color-bg) 28%);

  /* --- Typography --- */
  --font-serif: ui-serif, "Iowan Old Style", Garamond, "Times New Roman", Times, serif;
  --font-sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
  --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

  --text-size: 17px;     /* body: 16–18px */
  --text-leading: 1.72;  /* body: 1.6–1.8 */
  --measure: 720px;      /* max width for text blocks */

  /* --- Spacing scale (only these) --- */
  --space-1: 8px;
  --space-2: 16px;
  --space-3: 24px;
  --space-4: 40px;
  --space-5: 64px;

  /* --- Shape & motion (consistent everywhere) --- */
  --radius: 8px;
  --radius-sm: 8px;
  --ring: 2px;
  --transition: 180ms ease-in-out; /* 150–200ms, ease-in-out */
}

/* --- Base / reset --- */
*,
*::before,
*::after{ box-sizing: border-box; }

html, body{ height: 100%; }

body{
  margin: 0;
  background: var(--color-bg);
  color: var(--color-text);
  font-family: var(--font-sans);
  font-size: var(--text-size);
  line-height: var(--text-leading);
  -webkit-font-smoothing: antialiased;
  text-rendering: geometricPrecision;
}

img{ max-width: 100%; display: block; }
button, input, textarea, select{ font: inherit; color: inherit; }
a{ color: inherit; }

::selection{
  background: color-mix(in oklab, var(--color-accent) 18%, var(--color-bg) 82%);
}

/* --- Typography primitives --- */
.kds-measure{
  max-width: var(--measure);
}

.kds-prose{
  max-width: var(--measure);
}

.kds-prose p{
  margin: 0 0 var(--space-2) 0;
}

.kds-prose p:last-child{
  margin-bottom: 0;
}

.kds-h1,
.kds-h2,
.kds-h3{
  font-family: var(--font-serif);
  letter-spacing: 0.01em;
  margin: 0;
}

.kds-h1{
  font-size: 48px;
  line-height: 1.1;
  margin-bottom: var(--space-1);
}

.kds-h2{
  font-size: 32px;
  line-height: 1.15;
  margin-bottom: var(--space-1);
}

.kds-h3{
  font-size: 24px;
  line-height: 1.25;
  margin-bottom: var(--space-1);
}

.kds-subtext{
  margin: 0;
  color: var(--color-muted-text);
}

.kds-small{
  font-size: 14px;
  line-height: 1.6;
  color: var(--color-muted-text);
}

/* --- Layout primitives --- */
.kds-page{
  min-height: 100%;
  display: flex;
  flex-direction: column;
}

.kds-container{
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding-left: var(--space-3);
  padding-right: var(--space-3);
}

/* Required global structure:
   [Top Bar] → [Context Header] → [Primary + Secondary] → [Proof Footer]
*/
.kds-topbar{
  position: sticky;
  top: 0;
  z-index: 5;
  background: color-mix(in oklab, var(--color-bg) 94%, var(--color-text) 6%);
  border-bottom: 1px solid var(--color-border);
}

.kds-topbar__inner{
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: var(--space-2);
  align-items: center;
  padding-top: var(--space-2);
  padding-bottom: var(--space-2);
}

.kds-projectName{
  font-weight: 600;
  letter-spacing: 0.01em;
}

.kds-progress{
  display: inline-flex;
  align-items: center;
  gap: var(--space-2);
  color: var(--color-muted-text);
}

.kds-progress__bar{
  width: 160px;
  height: 8px;
  border-radius: 999px;
  background: color-mix(in oklab, var(--color-text) 10%, var(--color-bg) 90%);
  border: 1px solid var(--color-border);
  overflow: hidden;
}
.kds-progress__fill{
  height: 100%;
  background: var(--color-accent);
  width: 0%;
}

.kds-topbar__right{
  display: flex;
  justify-content: flex-end;
}

.kds-contextHeader{
  padding-top: var(--space-5);
  padding-bottom: var(--space-3);
}

.kds-workspace{
  flex: 1;
  padding-bottom: var(--space-4);
}

.kds-grid{
  display: grid;
  grid-template-columns: 7fr 3fr; /* 70% / 30% */
  gap: var(--space-3);
  align-items: start;
}

.kds-proofFooter{
  position: sticky;
  bottom: 0;
  background: color-mix(in oklab, var(--color-bg) 96%, var(--color-text) 4%);
  border-top: 1px solid var(--color-border);
}

.kds-proofFooter__inner{
  padding-top: var(--space-2);
  padding-bottom: var(--space-2);
  display: grid;
  grid-template-columns: 1fr;
  gap: var(--space-2);
}

/* --- Surfaces --- */
.kds-card{
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius);
  padding: var(--space-3);
}

.kds-card--tight{ padding: var(--space-2); }

.kds-divider{
  height: 1px;
  background: var(--color-border);
  margin: var(--space-3) 0;
}

/* --- Buttons --- */
.kds-btn{
  appearance: none;
  border: 1px solid transparent;
  border-radius: var(--radius-sm);
  padding: var(--space-1) var(--space-2);
  line-height: 1;
  font-weight: 600;
  letter-spacing: 0.01em;
  cursor: pointer;
  transition: background var(--transition), border-color var(--transition), color var(--transition);
}

.kds-btn:disabled{
  opacity: 0.55;
  cursor: not-allowed;
}

.kds-btn--primary{
  background: var(--color-accent);
  border-color: var(--color-accent);
  color: var(--color-bg);
}

.kds-btn--secondary{
  background: transparent;
  border-color: var(--color-border-strong);
  color: var(--color-text);
}

.kds-btn--quiet{
  background: transparent;
  border-color: transparent;
  color: var(--color-muted-text);
  padding-left: var(--space-1);
  padding-right: var(--space-1);
}

.kds-btn--primary:hover:not(:disabled){
  background: color-mix(in oklab, var(--color-accent) 88%, var(--color-text) 12%);
  border-color: color-mix(in oklab, var(--color-accent) 88%, var(--color-text) 12%);
}

.kds-btn--secondary:hover:not(:disabled){
  background: color-mix(in oklab, var(--color-text) 4%, var(--color-bg) 96%);
  border-color: color-mix(in oklab, var(--color-text) 30%, var(--color-bg) 70%);
}

.kds-btn--quiet:hover:not(:disabled){
  background: color-mix(in oklab, var(--color-text) 4%, var(--color-bg) 96%);
  color: var(--color-text);
}

/* --- Focus --- */
:focus{ outline: none; }
.kds-focus:focus,
.kds-btn:focus,
.kds-input:focus,
.kds-textarea:focus,
.kds-select:focus{
  box-shadow: 0 0 0 var(--ring) color-mix(in oklab, var(--color-accent) 34%, var(--color-bg) 66%);
  border-color: color-mix(in oklab, var(--color-accent) 48%, var(--color-bg) 52%);
}

/* --- Inputs --- */
.kds-field{ display: grid; gap: var(--space-1); }
.kds-label{ font-weight: 600; letter-spacing: 0.01em; }

.kds-input,
.kds-textarea,
.kds-select{
  width: 100%;
  background: color-mix(in oklab, var(--color-bg) 92%, var(--color-text) 8%);
  border: 1px solid var(--color-border-strong);
  border-radius: var(--radius-sm);
  padding: var(--space-1) var(--space-2);
  transition: border-color var(--transition), box-shadow var(--transition), background var(--transition);
}

.kds-textarea{ min-height: var(--space-5); resize: vertical; }

.kds-help{
  margin: 0;
  color: var(--color-muted-text);
  font-size: 14px;
  line-height: 1.6;
}

/* --- Badges (Top Bar status) --- */
.kds-badge{
  display: inline-flex;
  align-items: center;
  gap: var(--space-1);
  padding: var(--space-1) var(--space-2);
  border-radius: 999px;
  border: 1px solid var(--color-border-strong);
  background: color-mix(in oklab, var(--color-bg) 92%, var(--color-text) 8%);
  color: var(--color-muted-text);
  font-weight: 600;
  letter-spacing: 0.01em;
  font-size: 14px;
  line-height: 1;
}

.kds-dot{
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: var(--color-muted-text);
}

.kds-badge--notStarted .kds-dot{ background: var(--color-muted-text); }
.kds-badge--inProgress .kds-dot{ background: var(--color-warning); }
.kds-badge--shipped .kds-dot{ background: var(--color-success); }

/* --- Secondary panel (step explanation + prompt + actions) --- */
.kds-panelTitle{
  margin: 0 0 var(--space-1) 0;
  font-weight: 700;
  letter-spacing: 0.01em;
}

.kds-promptBox{
  border: 1px solid var(--color-border);
  background: color-mix(in oklab, var(--color-bg) 88%, var(--color-text) 12%);
  border-radius: var(--radius);
  padding: var(--space-2);
}

.kds-promptBox pre{
  margin: 0;
  font-family: var(--font-mono);
  font-size: 14px;
  line-height: 1.6;
  color: color-mix(in oklab, var(--color-text) 90%, var(--color-bg) 10%);
  white-space: pre-wrap;
  word-break: break-word;
}

.kds-actions{
  display: grid;
  gap: var(--space-1);
}

.kds-actionsRow{
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-1);
}

/* --- Proof footer checklist (each requires proof input UI) --- */
.kds-proofList{
  display: grid;
  gap: var(--space-1);
}

.kds-proofItem{
  display: grid;
  grid-template-columns: auto 1fr;
  gap: var(--space-2);
  align-items: start;
  padding: var(--space-2);
  border: 1px solid var(--color-border);
  border-radius: var(--radius);
  background: var(--color-surface);
}

.kds-proofItem input[type="checkbox"]{
  width: var(--space-2);
  height: var(--space-2);
  margin-top: 0;
  accent-color: var(--color-accent);
}

.kds-proofMeta{
  display: grid;
  gap: var(--space-1);
}

.kds-proofName{
  font-weight: 700;
  letter-spacing: 0.01em;
  margin: 0;
}

.kds-proofInput{
  display: grid;
  gap: var(--space-1);
}

/* --- Error & Empty states --- */
.kds-emptyState,
.kds-errorState{
  border: 1px solid var(--color-border);
  border-radius: var(--radius);
  background: var(--color-surface);
  padding: var(--space-3);
}

.kds-emptyState__title,
.kds-errorState__title{
  margin: 0 0 var(--space-1) 0;
  font-weight: 800;
  letter-spacing: 0.01em;
}

.kds-emptyState__body,
.kds-errorState__body{
  margin: 0 0 var(--space-2) 0;
  color: var(--color-muted-text);
  max-width: var(--measure);
}

.kds-errorState{
  border-color: color-mix(in oklab, var(--color-accent) 35%, var(--color-border) 65%);
}

.kds-errorState__title{
  color: color-mix(in oklab, var(--color-accent) 80%, var(--color-text) 20%);
}

/* --- Utility spacing (only scale values) --- */
.kds-mt-1{ margin-top: var(--space-1); }
.kds-mt-2{ margin-top: var(--space-2); }
.kds-mt-3{ margin-top: var(--space-3); }
.kds-mt-4{ margin-top: var(--space-4); }
.kds-mt-5{ margin-top: var(--space-5); }

.kds-gap-1{ gap: var(--space-1); }
.kds-gap-2{ gap: var(--space-2); }
.kds-gap-3{ gap: var(--space-3); }
.kds-gap-4{ gap: var(--space-4); }
.kds-gap-5{ gap: var(--space-5); }

